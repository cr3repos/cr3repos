<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" href="../assets/img/CR-3-logo.png">
  <link rel="icon" type="image/png" href="../assets/img/CR-3-logo.png">
  <title>
    CR3 | Portal
  </title>
  <!--     Fonts and icons     -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/0.2.0/Chart.min.js" type="text/javascript"></script>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <!-- Nucleo Icons -->
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link id="pagestyle" href="../assets/css/argon-dashboard.css?v=2.0.2" rel="stylesheet" />
  <link rel="stylesheet" href="../assets/css/style.css">
</head>

<body class="g-sidenav-show bg-gray-200">
  <div class="min-height-300 bg-primary position-absolute w-100"></div>
  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4 ps bg-white " id="sidenav-main">
    <div class="sidenav-header">
      <i class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand m-0" href="/dashboard">
        <img src="../assets/img/CR-3-logo-main.png" class="navbar-brand-img h-100" alt="main_logo">
        <span class="ms-1 font-weight-bold">CR3</span>
      </a>
    </div>
    <hr class="horizontal dark mt-0">
    <div class="collapse navbar-collapse  w-auto " id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/dashboard">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="ni ni-tv-2 text-primary text-sm opacity-10"></i>
            </div>
            <span class="nav-link-text ms-1">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link " href="/profile">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class=" fa fa-solid text-sm opacity-10 text-warning fa-user"></i>
            </div>
            <span class="nav-link-text ms-1">Profile</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link " href="/message">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="fa text-success text-sm opacity-10 fa-solid fa-comment"></i>
            </div>
            <span class="nav-link-text ms-1">Chat</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/downlines">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="fa text-info text-sm opacity-10 fa-solid fa-list"></i>
            </div>
            <span class="nav-link-text ms-1">Downlines</span>
          </a>
        </li>
        <%  if( status == 'Active+'){  %>
        <li class="nav-item">
          <a class="nav-link " href="/orion">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="fa text-info text-sm opacity-10 fa-solid fa-bezier-curve"></i>
            </div>
            <span class="nav-link-text ms-1">Orion</span>
          </a>
        </li>
        <%  }  %>
        <li class="nav-item mt-3">
          <h6 class="ps-4 ms-2 text-uppercase text-xs font-weight-bolder opacity-6">Payments</h6>
        </li>
        <%  if( status == 'Active+'){  %>
          <li class="nav-item">
            <a class="nav-link active " href="/payment-portal">
              <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                <i class=" fa fa-solid text-warning text-sm opacity-10 fa-coins"></i>
              </div>
              <span class="nav-link-text ms-1">Franchise wallet</span>
            </a>
          </li>
        <%  }else{  %>
          <li class="nav-item">
            <a class="nav-link active " href="/payment-portal">
              <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                <i class=" fa fa-solid text-warning text-sm opacity-10 fa-coins"></i>
              </div>
              <span class="nav-link-text ms-1">ID activation</span>
            </a>
          </li>
        <%  }  %>

        <li class="nav-item ">
          <a class="nav-link" href="/withdraw">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class=" fa fa-solid text-danger text-sm opacity-10 fa-wallet"></i>
            </div>
            <span class="nav-link-text ms-1">Withdraw</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link " href="/crypto-withdraw">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class=" fa fa-solid text-danger text-sm opacity-10 fa-wallet"></i>
            </div>
            <span class="nav-link-text ms-1">Crypto withdraw</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="/history">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="fa fa-solid fa-clock text-primary text-sm opacity-10"></i>
            </div>
            <span class="nav-link-text ms-1">History</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link " href="/transactions">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="fa fa-solid fa-repeat text-info text-sm opacity-10"></i>
            </div>
            <span class="nav-link-text ms-1">Transactions</span>
          </a>
        </li>
      </ul>
    </div>
    <div class="sidenav-footer text-center mx-3 ">

      <a class="btn btn-danger btn-sm mb-0 w-70" href="/logout" type="button">Log out</a>
    </div>
  </aside>
  <main class="main-content border-radius-lg ">

    <!-- Navbar -->
    <nav class="navbar position-relative navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl " id="navbarBlur" data-scroll="false">
      <div class="container-fluid pt-3 py-1 px-3">
        <nav aria-label="breadcrumb">
          <a href="/dashboard">
            <h6 class="font-weight-bolder text-white mb-0">
              <img src="../assets/img/CR-3-logo-main.png" class="dashboard-logo float-left" alt="">
              Payment portal
            </h6>
          </a>
        </nav>
        <div class="collapse position-absolute end-0 px-3 navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
          <ul class="navbar-nav  justify-content-end">

            <li class="nav-item px-3 d-xl-none ps-3 d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-white p-0" id="iconNavbarSidenav">
                <div class="sidenav-toggler-inner">
                  <i class="sidenav-toggler-line bg-white"></i>
                  <i class="sidenav-toggler-line bg-white"></i>
                  <i class="sidenav-toggler-line bg-white"></i>
                </div>
              </a>
            </li>
            <%  if( status == 'Inactive'){  %>
            <li class="nav-item px-3 d-flex align-items-center">
              <a href="/profile" class="nav-link text-white p-0">
                <i class="fa fa-user fixed-plugin-button-nav cursor-pointer"></i>
              </a>
            </li>
            <%  }  %>
            <%  if( status == 'Active'){  %>
            <li class="nav-item px-3 d-flex align-items-center">
              <a href="/profile" class="nav-link text-white p-0">
                <i class=" fa fa-solid text-success fa-user"></i>
              </a>
            </li>
            <%  }  %>
            <%  if( status == 'Active+'){  %>
            <li class="nav-item px-3 d-flex align-items-center">
              <a href="/profile" class="nav-link text-white p-0">
                <i class=" fa fa-solid text-success fa-user-check"></i>
              </a>
            </li>
            <%  }  %>
          </ul>
        </div>
      </div>
    </nav>
    <!-- End Navbar -->
    <%  if( status == 'Inactive'){  %>
      <div class="container-fluid  pt-6 py-4">
        <div class="row">
          <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
            <div class="card overflow-hidden mb-4">
              <div class="card-header text-uppercase text-center py-3">
                <h6>Payment portal</h6>
              </div>
              <div class="card-body ">
                <div class="" id="alert">

                </div>
                <%  if(typeof alert != 'undefined'){  %>

                    <div class="alert text-white alert-<%= alert.alertType %> alert-dismissible fade show" role="alert">
                      <span><label for=""> <%= alert.alert %></label> </span>
                      <button type="button" class="btn-close text-dark" data-bs-dismiss="alert" aria-label="Close">&times</button>
                    </div>

                <%  } %>
                <%  if(typeof pending != 'undefined'){  %>

                  <div class="text-center">
                    <p hidden id="userEmail"><%=user.email%></p>
                  <div id="pay">
                    <label for="">Status</label>
                    <p class=" text-dark text-uppercase text-sm" id="status">
                      <%=status %>
                    </p>
                      <button  class="btn btn-sm btn-success " onclick="pending()">
                        Activate
                      </button >

                    </div>
                  </div>

                <%  }else{ %>
                    <div class="text-center">
                      <p hidden id="userEmail"><%=user.email%></p>
                    <div id="pay">
                      <label for="">Status</label>
                      <p class=" text-dark text-uppercase text-sm" id="status">
                        <%=status %>
                      </p>
                        <button  class="btn btn-sm btn-success " onclick="createCharge()">
                          Activate
                        </button >

                      </div>
                    </div>
                <% } %>

              </div>

              </div>
            </div>
          </div>
        </div>

    <%  }  %>
    <%  if( status == 'Active'){  %>
      <div class="container-fluid  pt-6 py-4">
        <div class="row">
          <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
            <div class="card overflow-hidden mb-4">
              <div class="card-header text-uppercase text-center py-3">
                <h6>Payment portal</h6>
              </div>
              <div class="card-body ">
                <div class="" id="alert">

                </div>
                <%  if(typeof alert != 'undefined'){  %>

                    <div class="alert text-white alert-<%= alert.alertType %> alert-dismissible fade show" role="alert">
                      <span><label for=""> <%= alert.alert %></label> </span>
                      <button type="button" class="btn-close text-dark" data-bs-dismiss="alert" aria-label="Close">&times</button>
                    </div>

                <%  } %>

                <%  if(typeof pending != 'undefined'){  %>

                  <div class="text-center">
                    <p hidden id="userEmail"><%=user.email%></p>
                  <div id="pay">
                    <label for="">Status</label>
                    <p class=" text-dark text-uppercase text-sm" id="status">
                      <%=status %>
                    </p>
                      <button  class="btn btn-sm btn-success " onclick="pending()">
                        Upgrade
                      </button >

                    </div>
                  </div>

                <%  }else{ %>
                    <div class="text-center">
                      <p hidden id="userEmail"><%=user.email%></p>
                    <div id="pay">
                      <label for="">Status</label>
                      <p class=" text-dark text-uppercase text-sm" id="status">
                        <%=status %>
                      </p>
                        <button  class="btn btn-sm btn-success " onclick="createCharge()">
                          Upgrade
                        </button >

                      </div>
                    </div>
                <% } %>
              </div>
              </div>
            </div>
          </div>
        </div>

    <%  }  %>
    <%  if( status == 'Active+'){  %>
      <div class="container-fluid  pt-6 py-4">
        <div class="row">
          <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
            <div class="card mb-4">
              <div class="card-header text-uppercase text-center py-3">
                <h6>Payment portal</h6>
              </div>
              <div class="card-body position-relative ">
                <%  if(typeof alert != 'undefined'){  %>

                    <div class="alert text-white alert-<%= alert.alertType %> alert-dismissible fade show" role="alert">
                      <span><label for=""> <%= alert.alert %></label> </span>
                      <button type="button" class="btn-close text-dark" data-bs-dismiss="alert" aria-label="Close">&times</button>
                    </div>

                <%  } %>
                <div class="row gx-4">
                  <div class="col mx-5 text-center">
                    <form class="" action="/id-activation" method="post">
                      <label for="">Sponsor ID</label>
                      <div class="row">
                        <div class="px-0 ">
                          <input type="text" required name="sponID" class="form-control text-center" placeholder="Enter Sponsor ID">
                        </div>
                      </div>
                      <br>
                      <div class="">
                        <button type="submit" class="btn btn-info text-white btn-block pt-2" name="button">Confirm</button>
                      </div>
                      <br>
                      <div class="">
                        <label>wallet balance : <%= wallet%>$</label>
                      </div>
                      <div class="position-absolute top-100 start-50 translate-middle">
                        <a href="/franchise-wallet" class="btn btn-sm label rounded-pill  btn-success ">Add balance</a>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              </div>
            </div>
          </div>
        </div>

    <%  }  %>

  </main>
  <!--   Core JS Files   -->

  <script src="assets/vendor/jquery/jquery.min.js"></script>
  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/chartjs.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script>
  <script>
         const btn = document.getElementById('btn');
         const pay = document.getElementById('pay');
         const alert = document.getElementById('alert');

         const createCharge = function() {
           $.ajax({
               type: 'GET',
               url: 'http://localhost:3000/api/createPackage',
               dataType: "json"
           }).done(function(res){
               data =  res;
               pay.innerHTML = `  <label for="">EMAIL</label>
                 <p class=" text-dark text-uppercase text-sm" id="status">
                   ${data.metadata.email}
                 </p>
                 <label for="">Package details</label>
                 <p class=" text-dark text-uppercase text-sm">
                   ${data.name}
                 </p>
                 <label for="">Amount payable</label>
                 <p class=" text-dark text-uppercase text-sm" id="amount">
                   ${data.pricing.local.amount}$
                 </p>
                 <hr class="horizontal dark">
                 <a class="btn btn-sm btn-danger mt-3" href="${data.hosted_url}"> Pay with Crypto</a>
                 <hr class="horizontal dark">
                 <a class="btn btn-sm btn-success mt-3" onclick="upi()"> Pay with UPI</a>
                 `



           });
         }

         const validate = function(){
           $.ajax({
               type: 'POST',
               url: 'http://localhost:3000/api/validate_transaction',
               data: {
                 transaction_id: document.getElementById('transaction_id').value,
                 email: document.getElementById('userEmail').innerHTML
               },
               dataType: "json"
           }).done(function(res){
               data =  res;
               if(data.validation == 'success'){
                 pay.innerHTML = `  <div>
                   <img src="../assets/img/pending.png" class="text-center w-40 mb-3" alt="">
                 </div>
                   <p class=" text-dark text-uppercase text-sm" id="status">
                    Your request will be processed after the payment conformation.
                   </p>

                   `
               }else{
                 alert.innerHTML = `
                  <div class="alert text-white alert-warning alert-dismissible fade show" role="alert">
                    <span><label for=""> Upi id is no longer valid!</label> </span>
                    <button type="button" class="btn-close text-dark" data-bs-dismiss="alert" aria-label="Close">&times</button>
                  </div>

                   `

               }

           });
         }

         const upi = function(){
           if(typeof status == 'Active'){
           pay.innerHTML = `
            <img src="../assets/img/activate.png" class="w-100">
             <hr class="horizontal dark mt-0">
             <label for="">Enter Upi Ref/UTR number below</label>
             <form class="">
               <input type="number" required class="form_control" autocomplete="off" id="transaction_id" name="transaction_id" value="">
               <button type="button" class="btn btn-sm btn-primary mt-3" onclick="validate()" name="button">Validate</button>
             </form>

             `
           }else{
           pay.innerHTML = `
            <img src="../assets/img/upgrade.png" class="w-100">
             <hr class="horizontal dark mt-0">
             <label for="">Enter Upi Ref/UTR number below</label>
             <form class="">
               <input type="number" required class="form_control" autocomplete="off" id="transaction_id" name="transaction_id" value="">
               <button type="button" class="btn btn-sm btn-primary mt-3" onclick="validate()" name="button">Validate</button>
             </form>

             `
           }
         }

         const pending = function(){
           pay.innerHTML = `  <div>
             <img src="../assets/img/pending.png" class="text-center w-40 mb-3" alt="">
           </div>
             <p class=" text-dark text-uppercase text-sm" id="status">
              Your request will be processed after the payment conformation.
             </p>

             `
          }
  </script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../assets/js/argon-dashboard.js?v=2.0.2"></script>
</body>

</html>
