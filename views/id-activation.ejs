<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" href="../assets/img/CR-3-logo.png">
  <link rel="icon" type="image/png" href="../assets/img/CR-3-logo.png">
  <title>
    CR3 | Portal
  </title>
  <!--     Fonts and icons     -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/0.2.0/Chart.min.js" type="text/javascript"></script>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <!-- Nucleo Icons -->
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link id="pagestyle" href="../assets/css/argon-dashboard.css?v=2.0.2" rel="stylesheet" />
  <link rel="stylesheet" href="../assets/css/style.css">
</head>

<body class="g-sidenav-show bg-gray-200">
  <div class="min-height-300 bg-primary position-absolute w-100"></div>
  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4 ps bg-white " id="sidenav-main">
    <div class="sidenav-header">
      <i class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand m-0" href="/dashboard">
        <img src="../assets/img/CR-3-logo-main.png" class="navbar-brand-img h-100" alt="main_logo">
        <span class="ms-1 font-weight-bold">CR3</span>
      </a>
    </div>
    <hr class="horizontal dark mt-0">
    <div class="collapse navbar-collapse  w-auto " id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/dashboard">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="ni ni-tv-2 text-primary text-sm opacity-10"></i>
            </div>
            <span class="nav-link-text ms-1">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link " href="/profile">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class=" fa fa-solid text-sm opacity-10 text-warning fa-user"></i>
            </div>
            <span class="nav-link-text ms-1">Profile</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link " href="/message">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="fa text-success text-sm opacity-10 fa-solid fa-comment"></i>
            </div>
            <span class="nav-link-text ms-1">Chat</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/downlines">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="fa text-info text-sm opacity-10 fa-solid fa-list"></i>
            </div>
            <span class="nav-link-text ms-1">Downlines</span>
          </a>
        </li>
        <%  if( status == 'Active+'){  %>
        <li class="nav-item">
          <a class="nav-link " href="/orion">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="fa text-info text-sm opacity-10 fa-solid fa-bezier-curve"></i>
            </div>
            <span class="nav-link-text ms-1">Orion</span>
          </a>
        </li>
        <%  }  %>
        <li class="nav-item mt-3">
          <h6 class="ps-4 ms-2 text-uppercase text-xs font-weight-bolder opacity-6">Payments</h6>
        </li>
        <%  if( status == 'Active+'){  %>
          <li class="nav-item">
            <a class="nav-link " href="/payment-portal">
              <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                <i class=" fa fa-solid text-warning text-sm opacity-10 fa-coins"></i>
              </div>
              <span class="nav-link-text ms-1">Franchise wallet</span>
            </a>
          </li>
        <%  }else{  %>
          <li class="nav-item">
            <a class="nav-link " href="/payment-portal">
              <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                <i class=" fa fa-solid text-warning text-sm opacity-10 fa-coins"></i>
              </div>
              <span class="nav-link-text ms-1">ID activation</span>
            </a>
          </li>
        <%  }  %>

        <li class="nav-item ">
          <a class="nav-link" href="/withdraw">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class=" fa fa-solid text-danger text-sm opacity-10 fa-wallet"></i>
            </div>
            <span class="nav-link-text ms-1">Withdraw</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link " href="/crypto-withdraw">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class=" fa fa-solid text-danger text-sm opacity-10 fa-wallet"></i>
            </div>
            <span class="nav-link-text ms-1">Crypto withdraw</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="/history">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="fa fa-solid fa-clock text-primary text-sm opacity-10"></i>
            </div>
            <span class="nav-link-text ms-1">History</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link " href="/transactions">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="fa fa-solid fa-repeat text-info text-sm opacity-10"></i>
            </div>
            <span class="nav-link-text ms-1">Transactions</span>
          </a>
        </li>
      </ul>
    </div>
    <div class="sidenav-footer text-center mx-3 ">

      <a class="btn btn-danger btn-sm mb-0 w-70" href="/logout" type="button">Log out</a>
    </div>
  </aside>
  <main class="main-content border-radius-lg ">

    <!-- Navbar -->
    <nav class="navbar position-relative navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl " id="navbarBlur" data-scroll="false">
      <div class="container-fluid pt-3 py-1 px-3">
        <nav aria-label="breadcrumb">
          <a href="/dashboard">
            <h6 class="font-weight-bolder text-white mb-0">
              <img src="../assets/img/CR-3-logo-main.png" class="dashboard-logo float-left" alt="">
              Payment portal
            </h6>
          </a>
        </nav>
        <div class="collapse position-absolute end-0 px-3 navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
          <ul class="navbar-nav  justify-content-end">

            <li class="nav-item px-3 d-xl-none ps-3 d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-white p-0" id="iconNavbarSidenav">
                <div class="sidenav-toggler-inner">
                  <i class="sidenav-toggler-line bg-white"></i>
                  <i class="sidenav-toggler-line bg-white"></i>
                  <i class="sidenav-toggler-line bg-white"></i>
                </div>
              </a>
            </li>
            <%  if( status == 'Inactive'){  %>
            <li class="nav-item px-3 d-flex align-items-center">
              <a href="/profile" class="nav-link text-white p-0">
                <i class="fa fa-user fixed-plugin-button-nav cursor-pointer"></i>
              </a>
            </li>
            <%  }  %>
            <%  if( status == 'Active'){  %>
            <li class="nav-item px-3 d-flex align-items-center">
              <a href="/profile" class="nav-link text-white p-0">
                <i class=" fa fa-solid text-success fa-user"></i>
              </a>
            </li>
            <%  }  %>
            <%  if( status == 'Active+'){  %>
            <li class="nav-item px-3 d-flex align-items-center">
              <a href="/profile" class="nav-link text-white p-0">
                <i class=" fa fa-solid text-success fa-user-check"></i>
              </a>
            </li>
            <%  }  %>
          </ul>
        </div>
      </div>
    </nav>
    <!-- End Navbar -->
      <div class="container-fluid  pt-6 py-4">
        <div class="row">
          <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4"  id="container">
            <div class="card overflow-hidden mb-4">
              <div class="card-header text-uppercase text-center py-3">
                <h6>ID activation </h6>
              </div>
              <div class="card-body " >
              <div id='alert_div'>

              </div>
                <div class="row gx-4">
                  <div class="card text-center">
                    <div class="card-body px-5 ">
                <%  if(typeof sponsor != 'undefined'){  %>
                      <label for=""> Username</label>
                      <p class=" text-dark text-uppercase text-sm">
                        <%=sponsor.userID %>
                      </p>
                      <label for="">Sponsor ID</label>
                      <p class=" text-dark text-uppercase text-sm">
                        <%=sponsor.sponID %>
                      </p>
                      <label for=""> Status</label>
                      <p class=" text-dark text-uppercase text-sm">
                        <%=sponsor.status %>
                      </p>
                        <%  if( sponsor.status == 'Inactive'){  %>
                            <input type="text" name="sponID" hidden id="sponID" value="<%=sponsor.sponID %>">
                            <input type="text" name="section" hidden id="section" value="activation">
                          <div class="">
                            <button type="button" name="button" onclick="validateUser()" class="btn btn-success btn-block pt-2" id="btn" name="button">Activate</button>
                          </div>
                        <%  }  %>
                        <%  if( sponsor.status == 'Active'){  %>
                            <input type="text" name="sponID" hidden  id="sponID" value="<%=sponsor.sponID %>">
                            <input type="text" name="section" hidden id="section" value="upgradation">
                          <div class="">
                            <button type="button" onclick="validateUser()" class="btn btn-danger btn-block pt-2" name="button">Upgrade</button>
                          </div>
                        <%  }  %>
                        <%  if( sponsor.status == 'Active+'){  %>
                          <div class="">
                            <button type="button" class="btn btn-danger text-white disabled btn-block pt-2" name="button">Active</button>
                          </div>
                        <%  }  %>
                  <%  }else{ %>
                      <label for=""> No user found</label>
                  <%    } %>
                    </div>
                  </div>
                </div>
              </div>

              </div>
            </div>
          </div>
        </div>

  </main>
  <!--   Core JS Files   -->

  <script src="assets/vendor/jquery/jquery.min.js"></script>
  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/chartjs.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  const classEvent = function(){
    if ($("#rememberMe").is(":checked")){
        $('#btn_btn').removeClass('disabled');
    }else{
      $('#btn_btn').addClass('disabled');
    }
  }
 const onClicked = function(){
   setTimeout(classEvent, 300)
 }
  </script>
  <script>
         const btn = document.getElementById('btn');
         const container = document.getElementById('container');

         const validate = function() {
           $.ajax({
               type: 'POST',
               url: 'https://cr3-24.com/api/totp-secret/',
               data: {
                section: document.getElementById('section').value,
                sponID: document.getElementById('sponID').value
               }
           }).done(function(res){
             if(res.exist == true){
               if(res.alert.alert != 'Low balance'){
                 document.getElementById('container').innerHTML = `
                   <div class="card">
                    <div class="card-body p-3">
                      <div class="container text-center">
                          <h3>TWO-FACTOR AUTHENTICATION</h3>
                          <hr class="horizontal dark">
                          <div class="form__group form__pincode">
                            <label>Enter 6-digit code from your authenticator application</label>
                            <input type="tel" name="token" maxlength="6" minlength="6" id="token" tabindex="1" class="text-center form-control" autocomplete="off">
                          </div>
                          <div id="res_div">
                          </div>
                          <div class="">
                              <input type="text" name="sponID" hidden value="${res.sponID}" id="sponID">
                              <input type="text" name="section" hidden value="${res.section}" id="section">
                              <button type="button" onclick="authenticate()" id="authenticator" class="btn btn-primary mt-3">Authenticate</button>
                          </div>
                      </div>
                    </div>
                  </div>`
               }else{
                 if(res.alert.alert == 'ID is already in Active state'){
                   document.getElementById('alert_div').innerHTML = `    <div class="alert text-white alert-${ res.alert.alertType} alert-dismissible fade show" role="alert">
                         <span><label for=""> ${ res.alert.alert}</label> </span>
                         <button type="button" class="btn-close text-dark" data-bs-dismiss="alert" aria-label="Close">&times</button>
                       </div>`
                 }else{
                   document.getElementById('alert_div').innerHTML = `    <div class="alert text-white alert-${ res.alert.alertType} alert-dismissible fade show" role="alert">
                         <span><label for=""> ${ res.alert.alert}</label> </span>
                         <button type="button" class="btn-close text-dark" data-bs-dismiss="alert" aria-label="Close">&times</button>
                       </div>`
                 }

               }

             }else{
               document.getElementById('container').innerHTML = `<div class="card">
                   <div class="card-body p-3">
                     <div class="container text-center">
                         <h3>TWO-FACTOR AUTHENTICATION</h3>
                         <hr class="horizontal dark">
                         <div class="form__group form__pincode">
                           <label>Download an authenticator app and scan the code to enable 2FA</label>
                             <img src="${res.data}" alt="">
                         </div>
                         <hr class="horizontal dark">
                         <div>
                           <label class="">Or enter the code manually</label>
                           <p id="secret" class="text-dark font-weight-bold text-sm">${res.secret}</p>
                         </div>
                         <hr class="horizontal dark">
                         <div class="">
                           <div class="">
                             <input class="" onclick="onClicked()" name="check" type="checkbox" id="rememberMe">
                             <input type="text" name="sponID" value="" hidden id="sponID">
                             <label class=" text-secondary" for="rememberMe">I have generated my TOTP</label>
                           </div>
                           <button id="btn_btn" onclick="totp_secret()" class="disabled text-white btn btn-primary mt-3">Continue</button>
                         </div>
                     </div>
                   </div>
                 </div>`

             }
           });
         }
         const totp_secret = function(){
           $.ajax({
               type: 'POST',
               url: 'https://cr3-24.com/api/totp-validate/',
               data: {
                secret: document.getElementById('secret').innerHTML,
                sponID: document.getElementById('sponID').value
               }
           }).done(function(res){
             window.location.href='https://cr3-24.com/dashboard';
           });
         }
         const authenticate = function(){
           $('#authenticator').addClass('disabled text-white');
           $.ajax({
               type: 'POST',
               url: 'https://cr3-24.com/api/totp-validate/',
               data: {
                section: document.getElementById('section').value,
                sponID: document.getElementById('sponID').value,
                token: document.getElementById('token').value
               }
           }).done(function(res){
             console.log(res.valid);
             if(res.valid == true){
               document.getElementById('res_div').innerHTML = `
               <label class="text-success">Authentication success</label>`
               const redirect = window.location.href='https://cr3-24.com/dashboard';
                 setTimeout(redirect, 800);

             }else{
               $('#authenticator').removeClass('disabled text-white');
               document.getElementById('res_div').innerHTML =`<label class="text-danger">Authentication failed</label>`
             }
           });
         }

         const validateUser = function(){
            setTimeout(validate, 1200);
         }
  </script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../assets/js/argon-dashboard.js?v=2.0.2"></script>
</body>

</html>
